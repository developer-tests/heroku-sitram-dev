{"version":3,"file":"wc-blocks/coupon-filter/index.js","mappings":"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","sources":["webpack://wonder-cart/./includes/wc-blocks/assets/js/common.js","webpack://wonder-cart/external window [\"wc\",\"blocksCheckout\"]","webpack://wonder-cart/external window [\"wp\",\"apiFetch\"]","webpack://wonder-cart/external window [\"wp\",\"data\"]","webpack://wonder-cart/external window [\"wp\",\"element\"]","webpack://wonder-cart/external window [\"wp\",\"plugins\"]","webpack://wonder-cart/external window [\"wp\",\"url\"]","webpack://wonder-cart/webpack/bootstrap","webpack://wonder-cart/webpack/runtime/compat get default export","webpack://wonder-cart/webpack/runtime/define property getters","webpack://wonder-cart/webpack/runtime/hasOwnProperty shorthand","webpack://wonder-cart/webpack/runtime/make namespace object","webpack://wonder-cart/./includes/wc-blocks/assets/js/coupon-filter/index.js"],"sourcesContent":["export const convertToAmount = ( rawPrice, currencyMinorUnit) =>{\n   return parseInt(rawPrice,10) / 10 **currencyMinorUnit;\n}","module.exports = window[\"wc\"][\"blocksCheckout\"];","module.exports = window[\"wp\"][\"apiFetch\"];","module.exports = window[\"wp\"][\"data\"];","module.exports = window[\"wp\"][\"element\"];","module.exports = window[\"wp\"][\"plugins\"];","module.exports = window[\"wp\"][\"url\"];","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import {registerPlugin} from '@wordpress/plugins';\nimport apiFetch from '@wordpress/api-fetch';\nimport {useSelect, dispatch, select} from \"@wordpress/data\";\nimport {useEffect} from \"@wordpress/element\";\nimport {addQueryArgs} from '@wordpress/url'\nimport {registerCheckoutFilters} from '@woocommerce/blocks-checkout';\nimport {convertToAmount} from \"../common\";\n\nconst getSubtotal = (cartData) => {\n    let subtotal = 0;\n\n    cartData.items.forEach(item => {\n        const totals = item.totals;\n        subtotal += 'yes' === yith_sales_cart_discount_block.display_prices_including_tax ? parseInt(totals.line_subtotal) + parseInt(totals.line_subtotal_tax) : parseInt(totals.line_subtotal);\n    });\n\n    return convertToAmount(subtotal, cartData.totals.currency_minor_unit);\n}\n\nconst maybeAddCoupon = (cartData) => {\n    const appliedCoupons = cartData.coupons;\n    const yithSalesCoupon = appliedCoupons.filter(coupon => coupon.code === yith_sales_cart_discount_block.coupon_code).shift();\n\n    if (!yithSalesCoupon?.code) {\n        apiFetch({\n            path: addQueryArgs('/wc/store/v1/cart/apply-coupon', {\n                code: yith_sales_cart_discount_block.coupon_code,\n                context: 'yith_sales_block'\n            }),\n            method: 'POST',\n            cache: 'no-store',\n        }).then((result) => {\n            dispatch('wc/store/cart').receiveCart(result);\n        }).catch((error) => {\n            dispatch('wc/store/cart').receiveError(error);\n        });\n    }\n}\n\nconst maybeRemoveCoupon = (cartData) => {\n    const appliedCoupons = cartData.coupons;\n    const yithSalesCoupon = appliedCoupons.filter(coupon => coupon.code === yith_sales_cart_discount_block.coupon_code).shift();\n    if (yithSalesCoupon?.code) {\n        apiFetch({\n            path: addQueryArgs('/wc/store/v1/cart/remove-coupon', {\n                code: yith_sales_cart_discount_block.coupon_code,\n                context: 'yith_sales_block'\n            }),\n            method: 'POST',\n            cache: 'no-store',\n        }).then((result) => {\n            dispatch('wc/store/cart').receiveCart(result);\n        }).catch((error) => {\n            dispatch('wc/store/cart').receiveError(error);\n        });\n    }\n}\nconst render = () => {\n    const cartData = useSelect((select) => select('wc/store/cart').getCartData());\n    const subtotal = getSubtotal(cartData);\n    useEffect(() => {\n      if( cartData.items.length > 0 ) {\n          apiFetch({\n              path: addQueryArgs('/yith_sales/v1/campaigns/check-cart-discount', {cart_subtotal: subtotal}),\n              method: 'GET',\n              cache: 'no-store',\n          }).then((result) => {\n              if (result?.campaign && false !== result.campaign) {\n                  maybeAddCoupon(cartData);\n              } else {\n                  maybeRemoveCoupon(cartData);\n              }\n          });\n      }\n    }, [cartData]);\n\n\n}\n\nregisterPlugin('yith-sales-cart-discount-manager', {\n    render,\n    scope: 'woocommerce-checkout',\n})\nconst filterCoupons = (coupons) => {\n    return coupons.map((coupon) => {\n        const cartData =  select('wc/store/cart').getCartData();\n        const extensionExists = cartData.extensions?.yith_sales_wc_block_manager?.yith_sales_coupon_label !== '';\n        if (coupon.code !== yith_sales_cart_discount_block.coupon_code && extensionExists) {\n            return coupon;\n        }\n        let label = cartData.extensions.yith_sales_wc_block_manager.yith_sales_coupon_label;\n        return {\n            ...coupon,\n            label:label\n        }\n\n    });\n};\n\nregisterCheckoutFilters('yith-sales-rename-coupon', {\n    coupons: filterCoupons,\n});\n"],"names":["convertToAmount","rawPrice","currencyMinorUnit","parseInt","registerPlugin","apiFetch","useSelect","dispatch","select","useEffect","addQueryArgs","registerCheckoutFilters","getSubtotal","cartData","subtotal","items","forEach","item","totals","yith_sales_cart_discount_block","display_prices_including_tax","line_subtotal","line_subtotal_tax","currency_minor_unit","maybeAddCoupon","appliedCoupons","coupons","yithSalesCoupon","filter","coupon","code","coupon_code","shift","path","context","method","cache","then","result","receiveCart","catch","error","receiveError","maybeRemoveCoupon","render","getCartData","length","cart_subtotal","campaign","scope","filterCoupons","map","extensionExists","extensions","yith_sales_wc_block_manager","yith_sales_coupon_label","label"],"sourceRoot":""}